<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>æ­Œè©ç©ºæ ¼ç·¨è¼¯å™¨ Â· LouisLiao Piano é‹¼ç´ç·¨æ›²</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Noto Sans TC", sans-serif;
      background: #e8d6ba;
      background: radial-gradient(circle at top, #f7efe2 0, #e3cda7 45%, #d5b68c 100%);
      background-attachment: fixed;
      color: #5b3c25;
    }

    .wrap {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px 16px 40px;
    }

    /* --------------- é ‚éƒ¨å€ï¼šæ¨™é¡Œ + logo --------------- */
    .top-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 18px 24px;
      background: #faedd8;
      border-radius: 24px;
      box-shadow: 0 12px 28px rgba(121, 85, 61, 0.25);
      margin-bottom: 20px;
    }

    .top-title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 26px;
      font-weight: 900;
      letter-spacing: 2px;
    }

    .top-title-emoji {
      font-size: 30px;
    }

    .brand-pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px 9px;
      border-radius: 999px;
      background: #f4e2c9;
      color: #5b3c25;
      font-size: 15px;
      font-weight: 700;
      text-decoration: none;
      box-shadow: 0 6px 18px rgba(0,0,0,.18);
      transition: transform .15s ease, box-shadow .15s ease, background .15s ease;
      white-space: nowrap;
    }

    .brand-pill:hover {
      transform: translateY(-1px);
      box-shadow: 0 9px 22px rgba(0,0,0,.22);
      background: #f9ebd6;
    }

    .brand-pill-icon {
      font-size: 17px;
    }

    /* --------------- èªªæ˜æ–‡å­— --------------- */
    .intro-list {
      margin: 8px 4px 24px;
      font-size: 16px;
      line-height: 1.8;
    }

    .intro-item {
      margin-bottom: 2px;
    }

    /* --------------- ä¸»é«”é¢æ¿ --------------- */
    .panel {
      margin-top: 4px;
      display: grid;
      grid-template-columns: 1.25fr auto 1.25fr;
      gap: 24px;
      align-items: stretch;
    }

    textarea {
      width: 100%;
      min-height: 460px;
      border-radius: 26px;
      border: none;
      padding: 22px 22px;
      font-size: 18px;
      line-height: 1.9;
      resize: vertical;
      background: #fffaf4;
      box-shadow: 0 10px 26px rgba(0,0,0,.14);
      outline: none;
      white-space: pre-wrap;
    }

    textarea:focus {
      box-shadow: 0 12px 30px rgba(0,0,0,.2);
    }

    .panel-label {
      margin: 0 0 8px;
      font-size: 15px;
      opacity: .9;
    }

    .btn-col {
      display: flex;
      flex-direction: column;
      gap: 18px;
      align-items: center;
      justify-content: center;
    }

    .btn {
      border: none;
      cursor: pointer;
      border-radius: 999px;
      padding: 16px 32px;
      font-size: 20px;
      font-weight: 800;
      color: #5b3c25;
      width: 170px;
      text-align: center;
      background: linear-gradient(135deg, #fbe1ca, #f5cfae);
      box-shadow: 0 10px 20px rgba(125, 84, 57, .3);
      transition: transform .15s ease, box-shadow .15s ease, filter .15s ease;
      white-space: nowrap;
    }

    .btn.blue  { background: linear-gradient(135deg, #f4dac7, #e8c0a7); }
    .btn.red   { background: linear-gradient(135deg, #f7d3c7, #efb2aa); }
    .btn.green { background: linear-gradient(135deg, #e8dfc7, #d6c79d); }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 24px rgba(0,0,0,.28);
      filter: brightness(1.04);
    }

    .btn:active {
      transform: translateY(0);
      box-shadow: 0 6px 12px rgba(0,0,0,.22);
      filter: brightness(.96);
    }

    .footer-note {
      margin-top: 18px;
      font-size: 13px;
      opacity: .7;
      text-align: center;
    }

    /* --------------- LINE æ¼‚æµ®å®¢æœæŒ‰éˆ•ï¼ˆå¯æ‹–æ›³ + LINE å®˜æ–¹æ¨£å¼ï¼‰ --------------- */
    #lineFab {
      position: fixed;
      right: 22px;     /* åˆå§‹ä½ç½® */
      bottom: 22px;
      width: 58px;
      height: 58px;
      border-radius: 50%;
      z-index: 999;
      text-decoration: none;
      cursor: grab;
      touch-action: none;
    }

    #lineFab:active {
      cursor: grabbing;
    }

    .line-fab-inner {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background-color: #06C755;   /* LINE ç¶  */
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 10px 24px rgba(0,0,0,.3);
      transition: transform .15s ease, box-shadow .15s ease;
    }

    #lineFab:hover .line-fab-inner {
      transform: translateY(-1px);
      box-shadow: 0 13px 28px rgba(0,0,0,.35);
    }

    #lineFab svg {
      width: 34px;
      height: 34px;
      display: block;
    }

    /* --------------- LINE å½ˆå‡ºå°è¦–çª—ï¼ˆä»¿ EasyStore QR å¡ç‰‡ï¼‰ --------------- */
    .line-modal-overlay {
      position: fixed;
      inset: 0;
      display: none;             /* é è¨­éš±è— */
      justify-content: flex-end; /* é å³ */
      align-items: center;       /* å‚ç›´ç½®ä¸­ */
      background: rgba(0,0,0,.25);
      z-index: 998;
    }

    .line-modal {
      width: 320px;
      max-width: 90vw;
      background: #ffffff;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 18px 40px rgba(0,0,0,.35);
      margin-right: 22px;
    }

    .line-modal-header {
      background: #06C755;
      color: #ffffff;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 14px;
      font-size: 15px;
      font-weight: 600;
    }

    .line-modal-header-left {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .line-modal-logo-circle {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: #ffffff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      color: #06C755;
      font-weight: 700;
    }

    .line-modal-close {
      border: none;
      background: transparent;
      color: #ffffff;
      font-size: 20px;
      line-height: 1;
      cursor: pointer;
      padding: 0 4px;
    }

    .line-modal-body {
      padding: 16px 18px 20px;
      text-align: center;
    }

    .line-modal-qr {
      width: 210px;
      height: 210px;
      object-fit: contain;
      display: block;
      margin: 0 auto 14px;
    }

    .line-modal-link {
      display: inline-block;
      font-size: 14px;
      color: #7b3bb2;
      text-decoration: none;
      word-break: break-all;
    }

    .line-modal-link:hover {
      text-decoration: underline;
    }

    @media (max-width: 900px) {
      .panel {
        grid-template-columns: 1fr;
      }
      textarea {
        min-height: 260px;
      }
      .btn-col {
        flex-direction: row;
        flex-wrap: wrap;
      }
      .btn {
        width: auto;
        flex: 1 1 40%;
      }
      .top-bar {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }
      .line-modal {
        margin-right: 12px;
      }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <!-- ä¸Šæ–¹ï¼šæ¨™é¡Œ + logo -->
    <div class="top-bar">
      <div class="top-title">
        <span class="top-title-emoji">ğŸµ</span>
        <span>æ­Œè©ç©ºæ ¼ç·¨è¼¯å™¨</span>
      </div>
      <a class="brand-pill" href="https://louisliaopiano.com" target="_blank" rel="noopener">
        <span class="brand-pill-icon">â™ª</span>
        <span>LouisLiao Piano é‹¼ç´ç·¨æ›²</span>
      </a>
    </div>

    <!-- èªªæ˜ -->
    <div class="intro-list">
      <div class="intro-item">âœ” ä¸­æ–‡ï¼šç§»é™¤æ¨™é»ï¼Œåªä¿ç•™å­—èˆ‡ç©ºç™½ï¼Œè‡ªå‹•åœ¨ç›¸é„°ä¸­æ–‡å­—ä¸­æ’å…¥ã€Œä¸€å­—ä¸€ç©ºæ ¼ã€ï¼Œæ–¹ä¾¿ Sibelius è¼¸å…¥ã€‚</div>
      <div class="intro-item">âœ” è‹±æ–‡ï¼šä¿ç•™å–®å­—èˆ‡æ’‡è™Ÿï¼Œä¸æ‹†å­—ï¼Œåƒ…ç§»é™¤æ¨™é»ã€‚</div>
      <div class="intro-item">âœ” æœ¬å·¥å…·å®Œå…¨åœ¨ç€è¦½å™¨é‹ç®—ï¼Œä¸æœƒä¸Šå‚³ä»»ä½•è³‡æ–™ã€‚</div>
    </div>

    <!-- ä¸»é«”ï¼šå·¦æ­Œè© / æŒ‰éˆ• / å³æ­Œè© -->
    <div class="panel">
      <div>
        <p class="panel-label">åœ¨é€™è£¡è²¼ä¸ŠåŸå§‹æ­Œè©ï¼ˆç°¡é«” / ç¹é«” / è‹±æ–‡çš†å¯ï¼‰</p>
        <textarea id="inputLyrics" placeholder="åœ¨é€™è£¡è²¼ä¸ŠåŸå§‹æ­Œè©â€¦"></textarea>
      </div>

      <div class="btn-col">
        <button class="btn" id="btnPaste">è²¼ä¸Š</button>
        <button class="btn blue" id="btnConvert">è½‰æ›</button>
        <button class="btn" id="btnCopy">è¤‡è£½</button>
        <button class="btn red" id="btnClear">æ¸…ç©º</button>
        <button class="btn green" id="btnOneClick">ä¸€éµå®Œæˆ</button>
      </div>

      <div>
        <p class="panel-label">é€™è£¡æœƒé¡¯ç¤ºè™•ç†å¾Œçš„æ­Œè©â€¦</p>
        <textarea id="outputLyrics" placeholder="é€™è£¡æœƒé¡¯ç¤ºè™•ç†å¾Œçš„æ­Œè©â€¦" readonly></textarea>
      </div>
    </div>

    <div class="footer-note">
      æœ¬å·¥å…·å®Œå…¨åœ¨ç€è¦½å™¨å…§é‹ç®—ï¼Œä¸æœƒä¸Šå‚³ä»»ä½•å…§å®¹åˆ°ä¼ºæœå™¨ã€‚
    </div>
  </div>

  <!-- LINE å®¢æœæ¼‚æµ®æŒ‰éˆ• -->
  <a id="lineFab" href="https://lin.ee/aAgocM5"
     target="_blank" rel="noopener" aria-label="åŠ å…¥ LINE å®˜æ–¹å¸³è™Ÿ">
    <div class="line-fab-inner">
      <!-- æ›æˆè·Ÿä½ å¦ä¸€å€‹é é¢ä¸€æ¨£çš„ SVGï¼šç™½è‰²å¤§æ³¡æ³¡ + ç¶ è‰² LINE å­— -->
      <svg viewBox="0 0 64 64" aria-hidden="true">
        <!-- ç™½è‰²å°è©±æ¡† -->
        <path
          d="M32 12C21 12 12 19.5 12 29c0 7.2 5.4 13.2 13.5 14.7L26 52l7.2-5.4C44 45.9 52 38.2 52 29 52 19.5 43 12 32 12z"
          fill="#ffffff"
        />
        <!-- LINE å­—æ¨£ -->
        <text x="32" y="33" text-anchor="middle"
              font-size="14" font-weight="700"
              fill="#06c755"
              font-family="-apple-system,BlinkMacSystemFont,'Noto Sans TC',sans-serif">
          LINE
        </text>
      </svg>
    </div>
  </a>

  <!-- LINE å½ˆå‡ºè¦–çª—ï¼šQR å¡ç‰‡ -->
  <div id="lineModalOverlay" class="line-modal-overlay" aria-hidden="true">
    <div class="line-modal" role="dialog" aria-modal="true" aria-labelledby="lineModalTitle">
      <div class="line-modal-header">
        <div class="line-modal-header-left">
          <div class="line-modal-logo-circle">LINE</div>
          <div id="lineModalTitle">Line</div>
        </div>
        <button type="button" class="line-modal-close" aria-label="é—œé–‰">Ã—</button>
      </div>
      <div class="line-modal-body">
        <img
          class="line-modal-qr"
          src="https://raw.githubusercontent.com/h7860118/lyrics-space/main/line_oa_chat_210222_223854.jpg"
          alt="åŠ å…¥ LINE å¥½å‹ QR Code"
        />
        <a class="line-modal-link"
           href="https://lin.ee/aAgocM5"
           target="_blank"
           rel="noopener">
          https://lin.ee/aAgocM5
        </a>
      </div>
    </div>
  </div>

  <script>
    // 1) çµ±ä¸€å¥‡æ€ªçš„æ’‡è™ŸæˆåŠå½¢ '
    function normalizeEnglishApostrophes(text) {
      return text.replace(/[â€™â€˜Ê¼Â´Ê»ï¼‡]/g, "'");
    }

    // 2) ç§»é™¤æ‰€æœ‰æ¨™é»ç¬¦è™Ÿï¼ˆä¸­è‹±æ–‡ï¼‰ï¼Œåªä¿ç•™ï¼š
    //    - è‹±æ–‡å¤§å°å¯«
    //    - æ•¸å­—
    //    - å¸¸ç”¨ä¸­æ–‡ï¼ˆU+4E00â€“U9FFFï¼‰
    //    - ç©ºç™½ï¼ˆå«æ›è¡Œï¼‰
    //    - åŠå½¢æ’‡è™Ÿ '
    function removeAllPunctuation(text) {
      return text.replace(/[^a-zA-Z0-9\u4E00-\u9FFF\s']/g, "");
    }

    // 3) åªæœ‰ã€Œä¸­æ–‡ã€ä¹‹é–“åŠ ç©ºæ ¼ï¼Œè‹±æ–‡ä¸å‹•
    function addSpacesForChineseOnly(text) {
      const isCJK = ch => /[\u3400-\u4DBF\u4E00-\u9FFF]/.test(ch);

      return text
        .split("\n")
        .map(line => {
          const chars = [...line];
          let out = "";

          for (let i = 0; i < chars.length; i++) {
            const curr = chars[i];
            const next = chars[i + 1];

            out += curr;

            if (!next) continue;
            if (curr === " " || next === " ") continue;

            if (isCJK(curr) && isCJK(next)) {
              out += " ";
            }
          }
          return out;
        })
        .join("\n");
    }

    // 4) æ•´é«”è™•ç†æµç¨‹
    function processLyrics(text) {
      let t = text;
      t = normalizeEnglishApostrophes(t); // çµ±ä¸€æ’‡è™Ÿ
      t = removeAllPunctuation(t);        // æ¸…æ‰æ‰€æœ‰æ¨™é»
      t = addSpacesForChineseOnly(t);     // ä¸­æ–‡åŠ ç©ºæ ¼
      return t;
    }

    document.addEventListener("DOMContentLoaded", () => {
      const inputEl  = document.getElementById("inputLyrics");
      const outputEl = document.getElementById("outputLyrics");

      // è½‰æ›
      document.getElementById("btnConvert").addEventListener("click", () => {
        outputEl.value = processLyrics(inputEl.value);
      });

      // æ¸…ç©º
      document.getElementById("btnClear").addEventListener("click", () => {
        inputEl.value  = "";
        outputEl.value = "";
      });

      // å¾å‰ªè²¼ç°¿è²¼åˆ°å·¦é‚Š
      document.getElementById("btnPaste").addEventListener("click", async () => {
        try {
          const text = await navigator.clipboard.readText();
          inputEl.value = text;
        } catch (err) {
          alert("âš ï¸ ç„¡æ³•è®€å–å‰ªè²¼ç°¿ï¼Œè«‹æ‰‹å‹•è²¼ä¸Šã€‚");
        }
      });

      // æŠŠå³é‚Šè¤‡è£½å›å‰ªè²¼ç°¿
      document.getElementById("btnCopy").addEventListener("click", async () => {
        try {
          await navigator.clipboard.writeText(outputEl.value);
          alert("å·²è¤‡è£½ï¼");
        } catch (err) {
          outputEl.select();
          document.execCommand("copy");
          alert("å·²å˜—è©¦è¤‡è£½ï¼Œå¦‚æœªæˆåŠŸè«‹æ‰‹å‹•è¤‡è£½ã€‚");
        }
      });

      // ä¸€éµå®Œæˆï¼šå¾å‰ªè²¼ç°¿è²¼ä¸Š â†’ è™•ç† â†’ è¤‡è£½çµæœ
      document.getElementById("btnOneClick").addEventListener("click", async () => {
        try {
          const text = await navigator.clipboard.readText();
          inputEl.value = text;
          const processed = processLyrics(text);
          outputEl.value = processed;
          await navigator.clipboard.writeText(processed);
          alert("âœ” å·²å®Œæˆï¼šè²¼ä¸Š âœ è½‰æ› âœ è¤‡è£½ï¼");
        } catch (err) {
          alert("âš ï¸ ç„¡æ³•ä¸€éµå®Œæˆï¼Œè«‹åˆ†æ­¥æ“ä½œï¼ˆè²¼ä¸Š â†’ è½‰æ› â†’ è¤‡è£½ï¼‰ã€‚");
        }
      });

      /* ---- LINE æŒ‰éˆ•æ‹–æ›³ + å½ˆå‡ºè¦–çª— ---- */
      const fab = document.getElementById("lineFab");
      const overlay = document.getElementById("lineModalOverlay");
      const closeBtn = document.querySelector(".line-modal-close");

      if (!fab) return;

      let dragging = false;
      let dragMoved = false;
      let offsetX = 0;
      let offsetY = 0;
      let pointerId = null;

      fab.addEventListener("pointerdown", (e) => {
        dragging = true;
        dragMoved = false;
        pointerId = e.pointerId;
        fab.setPointerCapture(pointerId);

        const rect = fab.getBoundingClientRect();
        offsetX = e.clientX - rect.left;
        offsetY = e.clientY - rect.top;

        fab.style.transition = "none"; // æ‹–æ›³æ™‚é—œæ‰ä½ç§»å‹•ç•«
      });

      window.addEventListener("pointermove", (e) => {
        if (!dragging || e.pointerId !== pointerId) return;

        dragMoved = true;

        let x = e.clientX - offsetX;
        let y = e.clientY - offsetY;

        const margin = 8;
        const maxX = window.innerWidth - fab.offsetWidth - margin;
        const maxY = window.innerHeight - fab.offsetHeight - margin;

        x = Math.min(Math.max(margin, x), maxX);
        y = Math.min(Math.max(margin, y), maxY);

        fab.style.left = x + "px";
        fab.style.top = y + "px";
        fab.style.right = "auto";
        fab.style.bottom = "auto";
      });

      window.addEventListener("pointerup", (e) => {
        if (!dragging || e.pointerId !== pointerId) return;

        dragging = false;
        fab.releasePointerCapture(pointerId);
        pointerId = null;

        fab.style.transition = ""; // çµæŸæ‹–æ›³æ¢å¾©å‹•ç•«
      });

      // é»æ“ŠæŒ‰éˆ• â†’ é–‹å•Ÿ QR è¦–çª—ï¼ˆå¦‚æœåªæ˜¯ click è€Œä¸æ˜¯æ‹–æ›³ï¼‰
      fab.addEventListener("click", (e) => {
        // è‹¥å‰›å‰›æœ‰æ‹–å‹•ï¼Œå°±ä¸è¦ç•¶æˆé»æ“Š
        if (dragMoved) {
          dragMoved = false;
          return;
        }

        e.preventDefault(); // ä¸ç›´æ¥é–‹æ–°åˆ†é 

        if (overlay) {
          overlay.style.display = "flex";
          overlay.setAttribute("aria-hidden", "false");
        } else {
          // è¬ä¸€ overlay ä¸åœ¨ï¼Œå°±é€€å›åŸæœ¬è¡Œç‚ºï¼šé–‹é€£çµ
          const href = fab.getAttribute("href");
          if (href) window.open(href, "_blank");
        }
      });

      // é—œé–‰è¦–çª—
      function closeLineModal() {
        if (!overlay) return;
        overlay.style.display = "none";
        overlay.setAttribute("aria-hidden", "true");
      }

      if (closeBtn) {
        closeBtn.addEventListener("click", () => {
          closeLineModal();
        });
      }

      if (overlay) {
        overlay.addEventListener("click", (e) => {
          if (e.target === overlay) {
            closeLineModal();
          }
        });
      }
    });
  </script>
</body>
</html>
