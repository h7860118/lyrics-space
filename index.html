<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>æ­Œè©ç©ºæ ¼ç·¨è¼¯å™¨ Â· LouisLiao Piano é‹¼ç´ç·¨æ›²</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Noto Sans TC", sans-serif;
      background: #e8d6ba;
      background: radial-gradient(circle at top, #f7efe2 0, #e3cda7 45%, #d5b68c 100%);
      background-attachment: fixed;
      color: #5b3c25;
    }

    .wrap {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px 16px 40px;
    }

    /* --------------- é ‚éƒ¨å€ï¼šæ¨™é¡Œ + logo --------------- */
    .top-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 18px 24px;
      background: #faedd8;
      border-radius: 24px;
      box-shadow: 0 12px 28px rgba(121, 85, 61, 0.25);
      margin-bottom: 20px;
    }

    .top-title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 26px;
      font-weight: 900;
      letter-spacing: 2px;
    }

    .top-title-emoji {
      font-size: 30px;
    }

    .brand-pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px 9px;
      border-radius: 999px;
      background: #f4e2c9;
      color: #5b3c25;
      font-size: 15px;
      font-weight: 700;
      text-decoration: none;
      box-shadow: 0 6px 18px rgba(0,0,0,.18);
      transition: transform .15s ease, box-shadow .15s ease, background .15s ease;
      white-space: nowrap;
    }

    .brand-pill:hover {
      transform: translateY(-1px);
      box-shadow: 0 9px 22px rgba(0,0,0,.22);
      background: #f9ebd6;
    }

    .brand-pill-icon {
      font-size: 17px;
    }

    /* --------------- èªªæ˜æ–‡å­— --------------- */
    .intro-list {
      margin: 8px 4px 24px;
      font-size: 16px;
      line-height: 1.8;
    }

    .intro-item {
      margin-bottom: 2px;
    }

    /* --------------- ä¸»é«”é¢æ¿ --------------- */
    .panel {
      margin-top: 4px;
      display: grid;
      grid-template-columns: 1.25fr auto 1.25fr;
      gap: 24px;
      align-items: stretch;
    }

    textarea {
      width: 100%;
      min-height: 460px;
      border-radius: 26px;
      border: none;
      padding: 22px 22px;
      font-size: 18px;
      line-height: 1.9;
      resize: vertical;
      background: #fffaf4;
      box-shadow: 0 10px 26px rgba(0,0,0,.14);
      outline: none;
      white-space: pre-wrap;
    }

    textarea:focus {
      box-shadow: 0 12px 30px rgba(0,0,0,.2);
    }

    .panel-label {
      margin: 0 0 8px;
      font-size: 15px;
      opacity: .9;
    }

    .btn-col {
      display: flex;
      flex-direction: column;
      gap: 18px;
      align-items: center;
      justify-content: center;
    }

    .btn {
      border: none;
      cursor: pointer;
      border-radius: 999px;
      padding: 16px 32px;
      font-size: 20px;
      font-weight: 800;
      color: #5b3c25;
      width: 170px;
      text-align: center;
      background: linear-gradient(135deg, #fbe1ca, #f5cfae);
      box-shadow: 0 10px 20px rgba(125, 84, 57, .3);
      transition: transform .15s ease, box-shadow .15s ease, filter .15s ease;
      white-space: nowrap;
    }

    .btn.blue  { background: linear-gradient(135deg, #f4dac7, #e8c0a7); }
    .btn.red   { background: linear-gradient(135deg, #f7d3c7, #efb2aa); }
    .btn.green { background: linear-gradient(135deg, #e8dfc7, #d6c79d); }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 24px rgba(0,0,0,.28);
      filter: brightness(1.04);
    }

    .btn:active {
      transform: translateY(0);
      box-shadow: 0 6px 12px rgba(0,0,0,.22);
      filter: brightness(.96);
    }

    .footer-note {
      margin-top: 18px;
      font-size: 13px;
      opacity: .7;
      text-align: center;
    }

    /* --------------- LINE æ¼‚æµ®å®¢æœæŒ‰éˆ•ï¼ˆå¯æ‹–æ›³ + LINE å®˜æ–¹æ¨£å¼ï¼‰ --------------- */
    #lineFab {
      position: fixed;
      right: 22px;     /* åˆå§‹ä½ç½® */
      bottom: 22px;
      width: 58px;
      height: 58px;
      border-radius: 50%;
      z-index: 999;
      text-decoration: none;
      cursor: grab;
      touch-action: none;
    }

    #lineFab:active {
      cursor: grabbing;
    }

    .line-fab-inner {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background-color: #06C755;   /* LINE ç¶  */
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 10px 24px rgba(0,0,0,.3);
      transition: transform .15s ease, box-shadow .15s ease;
    }

    #lineFab:hover .line-fab-inner {
      transform: translateY(-1px);
      box-shadow: 0 13px 28px rgba(0,0,0,.35);
    }

    #lineFab svg {
      width: 34px;
      height: 34px;
      display: block;
    }

    @media (max-width: 900px) {
      .panel {
        grid-template-columns: 1fr;
      }
      textarea {
        min-height: 260px;
      }
      .btn-col {
        flex-direction: row;
        flex-wrap: wrap;
      }
      .btn {
        width: auto;
        flex: 1 1 40%;
      }
      .top-bar {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <!-- ä¸Šæ–¹ï¼šæ¨™é¡Œ + logo -->
    <div class="top-bar">
      <div class="top-title">
        <span class="top-title-emoji">ğŸµ</span>
        <span>æ­Œè©ç©ºæ ¼ç·¨è¼¯å™¨</span>
      </div>
      <a class="brand-pill" href="https://louisliaopiano.com" target="_blank" rel="noopener">
        <span class="brand-pill-icon">â™ª</span>
        <span>LouisLiao Piano é‹¼ç´ç·¨æ›²</span>
      </a>
    </div>

    <!-- èªªæ˜ -->
    <div class="intro-list">
      <div class="intro-item">âœ” ä¸­æ–‡ï¼šç§»é™¤æ¨™é»ï¼Œåªä¿ç•™å­—èˆ‡ç©ºç™½ï¼Œè‡ªå‹•åœ¨ç›¸é„°ä¸­æ–‡å­—ä¸­æ’å…¥ã€Œä¸€å­—ä¸€ç©ºæ ¼ã€ï¼Œæ–¹ä¾¿ Sibelius è¼¸å…¥ã€‚</div>
      <div class="intro-item">âœ” è‹±æ–‡ï¼šä¿ç•™å–®å­—èˆ‡æ’‡è™Ÿï¼Œä¸æ‹†å­—ï¼Œåƒ…ç§»é™¤æ¨™é»ã€‚</div>
      <div class="intro-item">âœ” æœ¬å·¥å…·å®Œå…¨åœ¨ç€è¦½å™¨é‹ç®—ï¼Œä¸æœƒä¸Šå‚³ä»»ä½•è³‡æ–™ã€‚</div>
    </div>

    <!-- ä¸»é«”ï¼šå·¦æ­Œè© / æŒ‰éˆ• / å³æ­Œè© -->
    <div class="panel">
      <div>
        <p class="panel-label">åœ¨é€™è£¡è²¼ä¸ŠåŸå§‹æ­Œè©ï¼ˆç°¡é«” / ç¹é«” / è‹±æ–‡çš†å¯ï¼‰</p>
        <textarea id="inputLyrics" placeholder="åœ¨é€™è£¡è²¼ä¸ŠåŸå§‹æ­Œè©â€¦"></textarea>
      </div>

      <div class="btn-col">
        <button class="btn" id="btnPaste">è²¼ä¸Š</button>
        <button class="btn blue" id="btnConvert">è½‰æ›</button>
        <button class="btn" id="btnCopy">è¤‡è£½</button>
        <button class="btn red" id="btnClear">æ¸…ç©º</button>
        <button class="btn green" id="btnOneClick">ä¸€éµå®Œæˆ</button>
      </div>

      <div>
        <p class="panel-label">é€™è£¡æœƒé¡¯ç¤ºè™•ç†å¾Œçš„æ­Œè©â€¦</p>
        <textarea id="outputLyrics" placeholder="é€™è£¡æœƒé¡¯ç¤ºè™•ç†å¾Œçš„æ­Œè©â€¦" readonly></textarea>
      </div>
    </div>

    <div class="footer-note">
      æœ¬å·¥å…·å®Œå…¨åœ¨ç€è¦½å™¨å…§é‹ç®—ï¼Œä¸æœƒä¸Šå‚³ä»»ä½•å…§å®¹åˆ°ä¼ºæœå™¨ã€‚
    </div>
  </div>

  <!-- LINE å®¢æœæ¼‚æµ®æŒ‰éˆ•ï¼ˆå¯æ‹–æ›³ + ç¬¬ä¸‰å¼µåœ–ç‰‡æ¨£å¼ï¼‰ -->
  <a id="lineFab" href="https://louisliaopiano.com/pages/llcs"
     target="_blank" rel="noopener" aria-label="è¯çµ¡ LINE å®¢æœ">
    <div class="line-fab-inner">
      <!-- ç¶ åº•åœ“å½¢ + ç™½è‰²å°è©±æ¡† + LINE å­—æ¨£ -->
      <svg viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <g fill="none" fill-rule="evenodd">
          <!-- ç™½è‰²å°è©±æ¡† -->
          <path d="M18 4C10.82 4 5 9.01 5 15.19c0 4.37 2.77 7.94 7.02 9.6-.31 1.04-1.17 3.9-1.34 4.52-.21.8.29.79.61.58.25-.17 3.94-2.68 5.54-3.77.73.07 1.48.11 2.24.11 7.18 0 13-5.01 13-11.19C32.07 9.01 25.18 4 18 4z"
                fill="#FFFFFF"/>
          <!-- LINE å­—æ¨£ -->
          <path d="M12.6 14.05v5.14H11v-5.14H9.4v-1.6H13v1.6h-.4zm3.06 5.14h-1.6v-6.74h1.6v6.74zm4.56 0h-4.02v-6.74h1.6v5.14h2.42v1.6zm4.78 0l-1.9-2.94-.02 2.94h-1.6v-6.74h1.6l-.02 2.83 1.83-2.83h1.87l-2.16 3.17 2.27 3.57h-1.87z"
                fill="#06C755"/>
        </g>
      </svg>
    </div>
  </a>

  <script>
    // 1) çµ±ä¸€å¥‡æ€ªçš„æ’‡è™ŸæˆåŠå½¢ '
    function normalizeEnglishApostrophes(text) {
      return text.replace(/[â€™â€˜Ê¼Â´Ê»ï¼‡]/g, "'");
    }

    // 2) ç§»é™¤æ‰€æœ‰æ¨™é»ç¬¦è™Ÿï¼ˆä¸­è‹±æ–‡ï¼‰ï¼Œåªä¿ç•™ï¼š
    //    - è‹±æ–‡å¤§å°å¯«
    //    - æ•¸å­—
    //    - å¸¸ç”¨ä¸­æ–‡ï¼ˆU+4E00â€“U+9FFFï¼‰
    //    - ç©ºç™½ï¼ˆå«æ›è¡Œï¼‰
    //    - åŠå½¢æ’‡è™Ÿ '
    function removeAllPunctuation(text) {
      return text.replace(/[^a-zA-Z0-9\u4E00-\u9FFF\s']/g, "");
    }

    // 3) åªæœ‰ã€Œä¸­æ–‡ã€ä¹‹é–“åŠ ç©ºæ ¼ï¼Œè‹±æ–‡ä¸å‹•
    function addSpacesForChineseOnly(text) {
      const isCJK = ch => /[\u3400-\u4DBF\u4E00-\u9FFF]/.test(ch);

      return text
        .split("\n")
        .map(line => {
          const chars = [...line];
          let out = "";

          for (let i = 0; i < chars.length; i++) {
            const curr = chars[i];
            const next = chars[i + 1];

            out += curr;

            if (!next) continue;
            if (curr === " " || next === " ") continue;

            if (isCJK(curr) && isCJK(next)) {
              out += " ";
            }
          }
          return out;
        })
        .join("\n");
    }

    // 4) æ•´é«”è™•ç†æµç¨‹
    function processLyrics(text) {
      let t = text;
      t = normalizeEnglishApostrophes(t); // çµ±ä¸€æ’‡è™Ÿ
      t = removeAllPunctuation(t);        // æ¸…æ‰æ‰€æœ‰æ¨™é»
      t = addSpacesForChineseOnly(t);     // ä¸­æ–‡åŠ ç©ºæ ¼
      return t;
    }

    document.addEventListener("DOMContentLoaded", () => {
      const inputEl  = document.getElementById("inputLyrics");
      const outputEl = document.getElementById("outputLyrics");

      // è½‰æ›
      document.getElementById("btnConvert").addEventListener("click", () => {
        outputEl.value = processLyrics(inputEl.value);
      });

      // æ¸…ç©º
      document.getElementById("btnClear").addEventListener("click", () => {
        inputEl.value  = "";
        outputEl.value = "";
      });

      // å¾å‰ªè²¼ç°¿è²¼åˆ°å·¦é‚Š
      document.getElementById("btnPaste").addEventListener("click", async () => {
        try {
          const text = await navigator.clipboard.readText();
          inputEl.value = text;
        } catch (err) {
          alert("âš ï¸ ç„¡æ³•è®€å–å‰ªè²¼ç°¿ï¼Œè«‹æ‰‹å‹•è²¼ä¸Šã€‚");
        }
      });

      // æŠŠå³é‚Šè¤‡è£½å›å‰ªè²¼ç°¿
      document.getElementById("btnCopy").addEventListener("click", async () => {
        try {
          await navigator.clipboard.writeText(outputEl.value);
          alert("å·²è¤‡è£½ï¼");
        } catch (err) {
          outputEl.select();
          document.execCommand("copy");
          alert("å·²å˜—è©¦è¤‡è£½ï¼Œå¦‚æœªæˆåŠŸè«‹æ‰‹å‹•è¤‡è£½ã€‚");
        }
      });

      // ä¸€éµå®Œæˆï¼šå¾å‰ªè²¼ç°¿è²¼ä¸Š â†’ è™•ç† â†’ è¤‡è£½çµæœ
      document.getElementById("btnOneClick").addEventListener("click", async () => {
        try {
          const text = await navigator.clipboard.readText();
          inputEl.value = text;
          const processed = processLyrics(text);
          outputEl.value = processed;
          await navigator.clipboard.writeText(processed);
          alert("âœ” å·²å®Œæˆï¼šè²¼ä¸Š âœ è½‰æ› âœ è¤‡è£½ï¼");
        } catch (err) {
          alert("âš ï¸ ç„¡æ³•ä¸€éµå®Œæˆï¼Œè«‹åˆ†æ­¥æ“ä½œï¼ˆè²¼ä¸Š â†’ è½‰æ› â†’ è¤‡è£½ï¼‰ã€‚");
        }
      });

      /* ---- LINE æŒ‰éˆ•æ‹–æ›³åŠŸèƒ½ ---- */
      const fab = document.getElementById("lineFab");
      if (!fab) return;

      let dragging = false;
      let offsetX = 0;
      let offsetY = 0;
      let pointerId = null;

      fab.addEventListener("pointerdown", (e) => {
        dragging = true;
        pointerId = e.pointerId;
        fab.setPointerCapture(pointerId);

        const rect = fab.getBoundingClientRect();
        offsetX = e.clientX - rect.left;
        offsetY = e.clientY - rect.top;

        fab.style.transition = "none"; // æ‹–æ›³æ™‚é—œæ‰ä½ç§»å‹•ç•«
      });

      window.addEventListener("pointermove", (e) => {
        if (!dragging || e.pointerId !== pointerId) return;

        let x = e.clientX - offsetX;
        let y = e.clientY - offsetY;

        const margin = 8;
        const maxX = window.innerWidth - fab.offsetWidth - margin;
        const maxY = window.innerHeight - fab.offsetHeight - margin;

        x = Math.min(Math.max(margin, x), maxX);
        y = Math.min(Math.max(margin, y), maxY);

        fab.style.left = x + "px";
        fab.style.top = y + "px";
        fab.style.right = "auto";
        fab.style.bottom = "auto";
      });

      window.addEventListener("pointerup", (e) => {
        if (!dragging || e.pointerId !== pointerId) return;

        dragging = false;
        fab.releasePointerCapture(pointerId);
        pointerId = null;

        fab.style.transition = ""; // çµæŸæ‹–æ›³æ¢å¾©å‹•ç•«
      });
    });
  </script>
</body>
</html>
